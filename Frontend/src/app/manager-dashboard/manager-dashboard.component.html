<app-navbar [userName]="managerName"></app-navbar>

<div class="d-flex" style="height: 100vh; overflow: hidden">
  <!-- Sidebar (Fixed) -->

  <div
    class="sidebar shadow p-3"
    style="width: 250px; background: rgb(156, 145, 145)"
  >
    <button
      class="btn btn-outline-primary mb-3 w-100"
      [class.active]="isPostJobVisible"
      (click)="showPostJob()"
    >
      <i class="bi bi-plus-circle"></i> Post Job
    </button>

    <button
      class="btn btn-outline-primary w-100"
      [class.active]="isPostedJobsVisible"
      (click)="showPostedJobs()"
    >
      <i class="bi bi-card-list"></i> Posted Jobs
    </button>
  </div>

  <!-- Main Content (Scrollable) -->

  <div class="flex-grow-1 overflow-auto p-4">
    <!-- Post Job Form -->

    <div *ngIf="isPostJobVisible">
      <h4
        class="mb-4 text-center"
        style="
          font-family: 'Times New Roman', Times, serif;
          color: rgb(54, 116, 181);
        "
      >
        <i class="bi bi-briefcase-fill me-2"></i>Post a Job
      </h4>

      <form (ngSubmit)="createJob()">
        <div class="mb-3">
          <label for="title" class="form-label fw-semibold">Job Title</label>

          <input
            id="title"
            [(ngModel)]="newJob.title"
            name="title"
            class="form-control"
            required
          />
        </div>

        <div class="mb-3">
          <label for="location" class="form-label fw-semibold">Location</label>

          <input
            id="location"
            [(ngModel)]="newJob.location"
            name="location"
            class="form-control"
            required
          />
        </div>

        <div class="mb-3">
          <label for="description" class="form-label fw-semibold"
            >Description</label
          >

          <textarea
            id="description"
            [(ngModel)]="newJob.description"
            name="description"
            class="form-control"
            rows="4"
            required
          ></textarea>
        </div>

        <div class="mb-3">
          <label for="lastDate" class="form-label fw-semibold"
            >Apply Before</label
          >

          <input
            id="lastDate"
            type="date"
            [(ngModel)]="newJob.lastDate"
            name="lastDate"
            class="form-control"
            required
          />
        </div>

        <div class="mb-3">
          <label for="skills" class="form-label fw-semibold"
            >Skills Required</label
          >

          <input
            id="skills"
            [(ngModel)]="newJob.skillsRequired"
            name="skillsRequired"
            class="form-control"
            placeholder="e.g. JavaScript, Angular, Node.js"
            required
          />
        </div>

        <div class="mb-3">
          <label for="certifications" class="form-label fw-semibold"
            >Certifications</label
          >

          <input
            id="certifications"
            [(ngModel)]="newJob.certifications"
            name="certifications"
            class="form-control"
            placeholder="e.g. AWS Certified, NPTEL Cloud Computing"
          />
        </div>

        <button type="submit" class="btn btn-primary d-block mx-auto">
          <i class="bi bi-check-circle"></i> Create Job
        </button>
      </form>
    </div>

    <!-- Posted Jobs -->

    <div *ngIf="isPostedJobsVisible" class="row">
      <h4
        class="text-center mb-3"
        style="
          font-family: 'Times New Roman', Times, serif;
          color: rgb(54, 116, 181);
        "
      >
        <i class="bi bi-briefcase-fill me-2"></i> Posted Jobs
      </h4>

      <div *ngIf="jobs && jobs.length > 0; else noJobs">
        <div *ngFor="let job of jobs" class="col-md-12 mb-4">
          <div class="card shadow-sm border-0 h-100">
            <div class="card-body d-flex flex-column">
              <h5>{{ job.title }}</h5>

              <p>
                <strong>Apply Before:</strong>
                {{ job.lastDate | date : "dd/MM/yyyy" }}<br />

                <strong>Skills:</strong> {{ job.skills }}<br />

                <strong>Description:</strong> {{ job.description }}
              </p>

              <div class="d-flex justify-content-between">
                <button class="btn btn-primary btn-sm" (click)="viewJob(job)">
                  <i class="bi bi-eye"></i> View Job
                </button>

                <button
                  class="btn btn-primary btn-sm"
                  (click)="viewApplicants(job)"
                >
                  <i class="bi bi-people"></i> View Applicants
                </button>

                <button
                  class="btn btn-danger btn-sm"
                  (click)="confirmDelete(job._id)"
                >
                  <i class="bi bi-trash"></i> Delete
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <ng-template #noJobs>
        <h1>No Jobs to Load</h1>
      </ng-template>
    </div>
  </div>
</div>

<!-- ✅ Success Modal -->

<div
  class="modal fade"
  id="successModal"
  tabindex="-1"
  aria-labelledby="successModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0 w-100 d-block text-center">
        <h5 class="modal-title w-100" id="successModalLabel">
          Job posted successfully!
        </h5>
      </div>

      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
          OK
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ✅ Delete Confirmation Modal -->

<div
  class="modal fade"
  id="deleteModal"
  tabindex="-1"
  aria-labelledby="deleteModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0">
      <div class="modal-header border-0 w-100 d-block text-center">
        <h5 class="modal-title w-100" id="deleteModalLabel">Confirm Delete</h5>
      </div>

      <div class="modal-body text-center">
        Are you sure you want to delete this job?
      </div>

      <div class="modal-footer border-0 justify-content-center">
        <button
          type="button"
          class="btn btn-secondary me-2"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>

        <button
          type="button"
          class="btn btn-danger"
          (click)="confirmAndCloseDelete()"
        >
          Yes, Delete
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Applicants Modal -->
<div
  class="modal fade"
  id="applicantsModal"
  tabindex="-1"
  aria-labelledby="applicantsModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="applicantsModalLabel">Applicants for {{ selectedJob?.title }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div *ngIf="selectedJobApplicants.length > 0; else noApplicants">
          <ul class="list-group">
            <li *ngFor="let applicant of selectedJobApplicants" class="list-group-item">
              <strong>Name:</strong> {{ applicant.name }} <br />
              <strong>Email:</strong> {{ applicant.email }} <br />
              <strong>Skills:</strong> {{ applicant.skills.join(', ') }}
            </li>
          </ul>
        </div>
        <ng-template #noApplicants>
          <p class="text-center text-muted">No applicants found for this job.</p>
        </ng-template>
      </div>
    </div>
  </div>
</div>

